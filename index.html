<!DOCTYPE html>
<html>
<head>
<title>JavaScript MQTT WebSocket Example</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
<script type="text/javascript" language="javascript">
// Plan: Make each sensor its own topic
var mqtt;
var reconnectTimeout=2000;
var host="broker.mqttdashboard.com";
var port=8000;
var topic="bison457";
var messageCount=1;

function onConnect(){
	console.log("Connected");
	mqtt.subscribe(topic + "/#");
	message = new Paho.MQTT.Message("Hello, World!");
	message.destinationName = topic;
	mqtt.send(message);
}

function MQTTconnect(){
	console.log("connecting to " + host + ":" + port);
	mqtt = new Paho.MQTT.Client(host, port, "clientjs");
	var options = {
		timeout: 3,
		onSuccess: onConnect,
		onFailure: onFailure,
	}
	mqtt.onMessageArrived = onMessageArrived;
	mqtt.connect(options);
}

function onFailure(){
	console.log("Connection attempt to host " + host + " failed!");
	setTimeout(MQTTconnect, reconnectTimeout);
}

function onMessageArrived(msg){
	out_msg = "Message received: " + msg.payloadString + " (topic: " + msg.destinationName + ")";
	console.log(out_msg);
}

function sendMessage(msg){
	mqtt.send(topic, msg + " " + messageCount);
	messageCount++;
}
</script>
</head>
<body>
<h1>Hello, MQTT!</h1>
<script>
MQTTconnect();
</script>
</body>
</html>
